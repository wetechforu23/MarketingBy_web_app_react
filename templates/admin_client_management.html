<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ client.clinic_name }} - Client Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .client-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .action-card {
            border-left: 4px solid #007bff;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .action-card.create-post { border-left-color: #28a745; }
        .action-card.create-content { border-left-color: #ffc107; }
        .action-card.website-analysis { border-left-color: #17a2b8; }
        .action-card.marketing-accounts { border-left-color: #6f42c1; }
        .action-card.billing { border-left-color: #dc3545; }
        .action-card.seo-tools { border-left-color: #20c997; }
        
        .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .code-viewer {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .status-active { background-color: #d4edda; color: #155724; }
        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-inactive { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Client Header -->
        <div class="client-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1><i class="fas fa-user-md"></i> {{ client.clinic_name }}</h1>
                        <p class="mb-0">{{ client.website }} | {{ client.email }} | {{ client.phone }}</p>
                        <small>Client since {{ client.created_at.strftime('%B %d, %Y') }}</small>
                    </div>
                    <div class="col-md-4 text-end">
                        <a href="/admin/clients" class="btn btn-light">
                            <i class="fas fa-arrow-left"></i> Back to Clients
                        </a>
                        <a href="/admin/keyword-management?client_id={{ client.id }}" class="btn btn-outline-light">
                            <i class="fas fa-key"></i> Keyword Management
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Quick Stats -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card metric-card">
                        <div class="card-body text-center">
                            <h5 class="card-title">SEO Score</h5>
                            <h2 class="mb-0">{{ latest_seo_score or 'N/A' }}</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Active Campaigns</h5>
                            <h2 class="mb-0">{{ active_campaigns_count }}</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Monthly Revenue</h5>
                            <h2 class="mb-0">${{ monthly_revenue or '0' }}</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card metric-card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Last Activity</h5>
                            <h6 class="mb-0">{{ last_activity or 'N/A' }}</h6>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Cards -->
            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="card action-card create-post h-100" onclick="openModal('createPostModal')">
                        <div class="card-body text-center">
                            <i class="fas fa-plus-circle fa-3x text-success mb-3"></i>
                            <h5 class="card-title">Create Post</h5>
                            <p class="card-text">Create social media posts, blog articles, and content for this client</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card action-card create-content h-100" onclick="openModal('createContentModal')">
                        <div class="card-body text-center">
                            <i class="fas fa-edit fa-3x text-warning mb-3"></i>
                            <h5 class="card-title">Create Content</h5>
                            <p class="card-text">Write blogs, create landing pages, and develop marketing content</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card action-card website-analysis h-100" onclick="analyzeWebsite()">
                        <div class="card-body text-center">
                            <i class="fas fa-code fa-3x text-info mb-3"></i>
                            <h5 class="card-title">Website Analysis</h5>
                            <p class="card-text">Analyze website code, SEO structure, and technical issues</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="card action-card marketing-accounts h-100" onclick="openModal('marketingAccountsModal')">
                        <div class="card-body text-center">
                            <i class="fas fa-bullhorn fa-3x text-purple mb-3"></i>
                            <h5 class="card-title">Marketing Accounts</h5>
                            <p class="card-text">Manage Google Ads, Facebook Ads, and other marketing platforms</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card action-card billing h-100" onclick="openModal('billingModal')">
                        <div class="card-body text-center">
                            <i class="fas fa-credit-card fa-3x text-danger mb-3"></i>
                            <h5 class="card-title">Billing & Payments</h5>
                            <p class="card-text">Charge clients, manage subscriptions, and track payments</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card action-card seo-tools h-100" onclick="openModal('seoToolsModal')">
                        <div class="card-body text-center">
                            <i class="fas fa-search fa-3x text-success mb-3"></i>
                            <h5 class="card-title">SEO Tools</h5>
                            <p class="card-text">Run SEO audits, keyword research, and competitor analysis</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Management Tabs -->
            <ul class="nav nav-tabs" id="managementTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
                        <i class="fas fa-chart-line"></i> Overview
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="content-tab" data-bs-toggle="tab" data-bs-target="#content" type="button" role="tab">
                        <i class="fas fa-file-alt"></i> Content
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="marketing-tab" data-bs-toggle="tab" data-bs-target="#marketing" type="button" role="tab">
                        <i class="fas fa-bullhorn"></i> Marketing
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab">
                        <i class="fas fa-chart-bar"></i> Analytics
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="billing-tab" data-bs-toggle="tab" data-bs-target="#billing" type="button" role="tab">
                        <i class="fas fa-dollar-sign"></i> Billing
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="managementTabContent">
                <!-- Overview Tab -->
                <div class="tab-pane fade show active" id="overview" role="tabpanel">
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-info-circle"></i> Client Information</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table table-borderless">
                                        <tr>
                                            <td><strong>Business Name:</strong></td>
                                            <td>{{ client.clinic_name }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Website:</strong></td>
                                            <td><a href="{{ client.website }}" target="_blank">{{ client.website }}</a></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Email:</strong></td>
                                            <td>{{ client.email }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Phone:</strong></td>
                                            <td>{{ client.phone }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Address:</strong></td>
                                            <td>{{ client.address }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Specialties:</strong></td>
                                            <td>{{ client.specialties or 'Not specified' }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Monthly Retainer:</strong></td>
                                            <td>${{ client.monthly_retainer or '0' }}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-chart-pie"></i> Recent Activity</h5>
                                </div>
                                <div class="card-body">
                                    <div class="list-group list-group-flush">
                                        {% for activity in recent_activities %}
                                        <div class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="mb-1">{{ activity.title }}</h6>
                                                <small class="text-muted">{{ activity.description }}</small>
                                            </div>
                                            <small class="text-muted">{{ activity.date }}</small>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Tab -->
                <div class="tab-pane fade" id="content" role="tabpanel">
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5><i class="fas fa-file-alt"></i> Content Management</h5>
                                    <button class="btn btn-primary" onclick="openModal('createContentModal')">
                                        <i class="fas fa-plus"></i> Create Content
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Title</th>
                                                    <th>Type</th>
                                                    <th>Status</th>
                                                    <th>Created</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for content in client_content %}
                                                <tr>
                                                    <td>{{ content.title }}</td>
                                                    <td>{{ content.content_type }}</td>
                                                    <td>
                                                        <span class="status-badge status-{{ content.status }}">
                                                            {{ content.status.title() }}
                                                        </span>
                                                    </td>
                                                    <td>{{ content.created_at.strftime('%Y-%m-%d') }}</td>
                                                    <td>
                                                        <a href="/admin/content/{{ content.id }}/approval-workflow" class="btn btn-sm btn-outline-info" title="View Approval Workflow">
                                                            <i class="fas fa-tasks"></i>
                                                        </a>
                                                        <button class="btn btn-sm btn-outline-primary" onclick="editContent({{ content.id }})" title="Edit Content">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-success" onclick="publishContent({{ content.id }})" title="Publish Content">
                                                            <i class="fas fa-rocket"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Marketing Tab -->
                <div class="tab-pane fade" id="marketing" role="tabpanel">
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-google"></i> Google Ads</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Account Status:</span>
                                        <span class="status-badge status-active">Connected</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Daily Budget:</span>
                                        <span>${{ google_ads_budget or '0' }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Active Campaigns:</span>
                                        <span>{{ google_ads_campaigns or '0' }}</span>
                                    </div>
                                    <button class="btn btn-primary w-100" onclick="manageGoogleAds()">
                                        <i class="fas fa-cog"></i> Manage Google Ads
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-facebook"></i> Facebook Ads</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Account Status:</span>
                                        <span class="status-badge status-active">Connected</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Daily Budget:</span>
                                        <span>${{ facebook_ads_budget or '0' }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Active Campaigns:</span>
                                        <span>{{ facebook_ads_campaigns or '0' }}</span>
                                    </div>
                                    <button class="btn btn-primary w-100" onclick="manageFacebookAds()">
                                        <i class="fas fa-cog"></i> Manage Facebook Ads
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div class="tab-pane fade" id="analytics" role="tabpanel">
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-chart-line"></i> Website Performance</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="websiteChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-chart-pie"></i> Traffic Sources</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="trafficChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Billing Tab -->
                <div class="tab-pane fade" id="billing" role="tabpanel">
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-credit-card"></i> Payment Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Payment Method:</span>
                                        <span>{{ payment_method or 'Not set' }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Next Billing Date:</span>
                                        <span>{{ next_billing_date or 'N/A' }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <span>Monthly Amount:</span>
                                        <span>${{ client.monthly_retainer or '0' }}</span>
                                    </div>
                                    <button class="btn btn-success w-100" onclick="chargeClient()">
                                        <i class="fas fa-credit-card"></i> Charge Client Now
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-history"></i> Payment History</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Amount</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for payment in payment_history %}
                                                <tr>
                                                    <td>{{ payment.date }}</td>
                                                    <td>${{ payment.amount }}</td>
                                                    <td>
                                                        <span class="status-badge status-{{ payment.status }}">
                                                            {{ payment.status.title() }}
                                                        </span>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Post Modal -->
    <div class="modal fade" id="createPostModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Post for {{ client.clinic_name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createPostForm">
                        <div class="mb-3">
                            <label for="postTitle" class="form-label">Post Title</label>
                            <input type="text" class="form-control" id="postTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="postContent" class="form-label">Post Content</label>
                            <textarea class="form-control" id="postContent" rows="4" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="postPlatform" class="form-label">Platform</label>
                            <select class="form-select" id="postPlatform" required>
                                <option value="">Select platform...</option>
                                <option value="facebook">Facebook</option>
                                <option value="instagram">Instagram</option>
                                <option value="linkedin">LinkedIn</option>
                                <option value="twitter">Twitter</option>
                                <option value="blog">Blog</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="postImage" class="form-label">Image URL (optional)</label>
                            <input type="url" class="form-control" id="postImage">
                        </div>
                        <div class="mb-3">
                            <label for="postSchedule" class="form-label">Schedule</label>
                            <select class="form-select" id="postSchedule">
                                <option value="now">Post Now</option>
                                <option value="schedule">Schedule for Later</option>
                            </select>
                        </div>
                        <div class="mb-3" id="scheduleDate" style="display: none;">
                            <label for="postDate" class="form-label">Schedule Date & Time</label>
                            <input type="datetime-local" class="form-control" id="postDate">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createPost()">Create Post</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Content Modal -->
    <div class="modal fade" id="createContentModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Content for {{ client.clinic_name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createContentForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="contentTitle" class="form-label">Content Title</label>
                                    <input type="text" class="form-control" id="contentTitle" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="contentType" class="form-label">Content Type</label>
                                    <select class="form-select" id="contentType" required>
                                        <option value="">Select type...</option>
                                        <option value="blog">Blog Post</option>
                                        <option value="landing_page">Landing Page</option>
                                        <option value="email">Email Campaign</option>
                                        <option value="social_media">Social Media</option>
                                        <option value="ad_copy">Ad Copy</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="contentBody" class="form-label">Content Body</label>
                            <textarea class="form-control" id="contentBody" rows="10" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="contentKeywords" class="form-label">Target Keywords</label>
                                    <input type="text" class="form-control" id="contentKeywords" placeholder="keyword1, keyword2, keyword3">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="contentStatus" class="form-label">Status</label>
                                    <select class="form-select" id="contentStatus">
                                        <option value="draft">Draft</option>
                                        <option value="review">Review</option>
                                        <option value="published">Published</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createContent()">Create Content</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Website Analysis Modal -->
    <div class="modal fade" id="websiteAnalysisModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Website Analysis - {{ client.website }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>HTML Source Code</h6>
                            <div class="code-viewer">
                                <pre id="htmlCode"><code>Loading...</code></pre>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>SEO Analysis</h6>
                            <div id="seoAnalysis">
                                <div class="text-center">
                                    <div class="spinner-border" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="downloadAnalysis()">Download Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Billing Modal -->
    <div class="modal fade" id="billingModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Billing - {{ client.clinic_name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="billingForm">
                        <div class="mb-3">
                            <label for="chargeAmount" class="form-label">Charge Amount ($)</label>
                            <input type="number" class="form-control" id="chargeAmount" step="0.01" value="{{ client.monthly_retainer or '0' }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="chargeDescription" class="form-label">Description</label>
                            <input type="text" class="form-control" id="chargeDescription" value="Monthly Marketing Services" required>
                        </div>
                        <div class="mb-3">
                            <label for="paymentMethod" class="form-label">Payment Method</label>
                            <select class="form-select" id="paymentMethod" required>
                                <option value="">Select payment method...</option>
                                <option value="stripe">Stripe (Credit Card)</option>
                                <option value="paypal">PayPal</option>
                                <option value="bank_transfer">Bank Transfer</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="processPayment()">
                        <i class="fas fa-credit-card"></i> Process Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        function openModal(modalId) {
            const modal = new bootstrap.Modal(document.getElementById(modalId));
            modal.show();
        }

        function analyzeWebsite() {
            openModal('websiteAnalysisModal');
            
            // Simulate website analysis
            setTimeout(() => {
                document.getElementById('htmlCode').innerHTML = `<code>${generateSampleHTML()}</code>`;
                document.getElementById('seoAnalysis').innerHTML = generateSEOAnalysis();
            }, 2000);
        }

        function generateSampleHTML() {
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ client.clinic_name }} - Healthcare Services</title>
    <meta name="description" content="Professional healthcare services...">
</head>
<body>
    <header>
        <nav>
            <a href="/">Home</a>
            <a href="/services">Services</a>
            <a href="/contact">Contact</a>
        </nav>
    </header>
    <main>
        <h1>Welcome to {{ client.clinic_name }}</h1>
        <p>Professional healthcare services...</p>
    </main>
</body>
</html>`;
        }

        function generateSEOAnalysis() {
            return `
                <div class="alert alert-success">
                    <h6><i class="fas fa-check-circle"></i> SEO Score: 85/100</h6>
                </div>
                <div class="alert alert-warning">
                    <h6><i class="fas fa-exclamation-triangle"></i> Issues Found:</h6>
                    <ul>
                        <li>Missing meta description</li>
                        <li>No structured data</li>
                        <li>Images missing alt tags</li>
                    </ul>
                </div>
                <div class="alert alert-info">
                    <h6><i class="fas fa-lightbulb"></i> Recommendations:</h6>
                    <ul>
                        <li>Add meta description</li>
                        <li>Implement structured data</li>
                        <li>Optimize images</li>
                        <li>Improve page speed</li>
                    </ul>
                </div>
            `;
        }

        function createPost() {
            const formData = {
                client_id: {{ client.id }},
                title: document.getElementById('postTitle').value,
                content: document.getElementById('postContent').value,
                platform: document.getElementById('postPlatform').value,
                image_url: document.getElementById('postImage').value,
                schedule: document.getElementById('postSchedule').value,
                schedule_date: document.getElementById('postDate').value
            };

            fetch('/admin/client/{{ client.id }}/create-post', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Post created successfully!');
                    location.reload();
                } else {
                    alert('Error creating post: ' + data.error);
                }
            });
        }

        function createContent() {
            const formData = {
                client_id: {{ client.id }},
                title: document.getElementById('contentTitle').value,
                content_type: document.getElementById('contentType').value,
                content_body: document.getElementById('contentBody').value,
                keywords: document.getElementById('contentKeywords').value,
                status: document.getElementById('contentStatus').value
            };

            fetch('/admin/client/{{ client.id }}/create-content', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Content created successfully!');
                    location.reload();
                } else {
                    alert('Error creating content: ' + data.error);
                }
            });
        }

        function processPayment() {
            const formData = {
                client_id: {{ client.id }},
                amount: document.getElementById('chargeAmount').value,
                description: document.getElementById('chargeDescription').value,
                payment_method: document.getElementById('paymentMethod').value
            };

            fetch('/admin/client/{{ client.id }}/process-payment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Payment processed successfully!');
                    location.reload();
                } else {
                    alert('Error processing payment: ' + data.error);
                }
            });
        }

        function manageGoogleAds() {
            window.open('https://ads.google.com', '_blank');
        }

        function manageFacebookAds() {
            window.open('https://business.facebook.com', '_blank');
        }

        function chargeClient() {
            openModal('billingModal');
        }

        // Initialize charts when analytics tab is shown
        document.getElementById('analytics-tab').addEventListener('shown.bs.tab', function() {
            // Website performance chart
            const websiteCtx = document.getElementById('websiteChart').getContext('2d');
            new Chart(websiteCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Website Traffic',
                        data: [1200, 1900, 3000, 5000, 2000, 3000],
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Traffic sources chart
            const trafficCtx = document.getElementById('trafficChart').getContext('2d');
            new Chart(trafficCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Organic', 'Paid', 'Social', 'Direct'],
                    datasets: [{
                        data: [40, 30, 20, 10],
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0'
                        ]
                    }]
                },
                options: {
                    responsive: true
                }
            });
        });

        // Show/hide schedule date based on selection
        document.getElementById('postSchedule').addEventListener('change', function() {
            const scheduleDate = document.getElementById('scheduleDate');
            if (this.value === 'schedule') {
                scheduleDate.style.display = 'block';
            } else {
                scheduleDate.style.display = 'none';
            }
        });
    </script>
</body>
</html>
